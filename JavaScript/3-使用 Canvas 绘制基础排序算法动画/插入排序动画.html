<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>使用 canvas 实现插入排序动画</title>
    <style>
      canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <h1>使用 canvas 实现插入排序动画</h1>
    <h3>
      插入排序的核心思想就是将一张张扑克牌逐个插入到已排好序的牌堆中，确保每张牌插入后，仍然保持有序。这个过程就像玩扑克牌时，手里的牌不断地按照大小顺序整理的过程，直到所有牌都被整理好。
    </h3>
    <canvas id="insertionSortCanvas" width="400" height="200"></canvas>
    <button onclick="startSorting()">开始排序</button>
    <div>
      <h4>
        插入排序是一种直观易懂的排序算法，其原理可以用以下通俗易懂的方式描述：
      </h4>
      <ol>
        <li>假设有一组数字排列在一张扑克牌上，这些牌是乱序的。</li>
        <li>
          插入排序会从第二张牌开始，逐一将每张牌插入到已经排好序的牌堆中。
        </li>
        <li>
          对于每张待插入的牌，它会从右向左依次与已排好序的牌比较，找到合适的位置插入。
        </li>
        <li>
          待插入的牌会与已排序的牌一一比较，直到找到一个比它小的牌或者遍历到最左边的位置。
        </li>
        <li>
          一旦找到合适的位置，就将待插入的牌插入到这个位置，同时原位置的牌依次右移，为新牌腾出位置。
        </li>
        <li>
          重复这个过程，逐渐将所有的牌插入到正确的位置，直到整副牌都有序。
        </li>
      </ol>
    </div>

    <script>
      const canvas = document.getElementById("insertionSortCanvas");
      const ctx = canvas.getContext("2d");

      const arr = [6, 5, 3, 1, 8, 7, 2, 4];
      const n = arr.length;

      let i = 1;

      function drawArray() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const barWidth = canvas.width / n;
        const barHeightUnit = canvas.height / Math.max(...arr);

        for (let k = 0; k < n; k++) {
          const x = k * barWidth;
          const height = arr[k] * barHeightUnit;

          // 绘制矩形
          ctx.fillStyle = k === i ? "red" : "blue";
          ctx.fillRect(x, canvas.height - height, barWidth - 2, height);

          // 标记数字
          ctx.fillStyle = "white";
          ctx.font = "20px Arial";
          ctx.fillText(
            arr[k],
            x + barWidth / 2 - 6,
            canvas.height - height + 20
          );
        }
      }

      function insertionSortStep() {
        if (i < n) {
          const key = arr[i];
          let j = i - 1;

          while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j--;
          }

          arr[j + 1] = key;
          i++;
        } else {
          // 排序完成
          clearInterval(animationInterval);
        }

        drawArray();
      }

      let animationInterval;

      function startSorting() {
        i = 1;

        // 设置动画间隔
        animationInterval = setInterval(insertionSortStep, 1500); // 调整动画速度
      }

      drawArray();
    </script>
  </body>
</html>
